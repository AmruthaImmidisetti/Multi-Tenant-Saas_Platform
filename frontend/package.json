{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.13.2",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.11.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.23",
    "babel-plugin-react-compiler": "^1.0.0",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "npm:rolldown-vite@7.2.5"
  },
  "overrides": {
    "vite": "npm:rolldown-vite@7.2.5"
  }
}




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

const db = require('../config/db');
const { v4: uuidv4 } = require('uuid');
const logAudit = require('../utils/auditLogger');

// exports.createProject = async (req, res) => {
//   const { name, description } = req.body;
//   const { tenantId } = req.user;

//   if (!name) {
//     return res.status(400).json({
//       success: false,
//       message: 'Project name is required'
//     });
//   }

//   // ðŸ‘‡ generate project ID once
//   const projectId = uuidv4();

//   await db.query(
//     `INSERT INTO projects (id, tenant_id, name, description)
//      VALUES ($1, $2, $3, $4)`,
//     [projectId, tenantId, name, description]
//   );

//   // ðŸ‘‡ ADDED AUDIT LOG (after successful insert)
//   await logAudit({
//     userId: req.user.userId,
//     tenantId: req.user.tenantId,
//     action: 'CREATE_PROJECT',
//     entityType: 'project',
//     entityId: projectId
//   });

//   res.status(201).json({
//     success: true,
//     message: 'Project created successfully'
//   });
// };

exports.createProject = async (req, res) => {
  const { name, description } = req.body;
  const tenantId = req.user.tenantId;

  if (!name) {
    return res.status(400).json({
      success: false,
      message: 'Project name is required'
    });
  }

  const projectId = uuidv4();

  await db.query(
    `INSERT INTO projects (id, tenant_id, name, description)
     VALUES ($1, $2, $3, $4)`,
    [projectId, tenantId, name, description]
  );

  await logAudit({
    userId: req.user.userId || req.user.user_id,
    tenantId: tenantId,
    action: 'CREATE_PROJECT',
    entityType: 'project',
    entityId: projectId
  });

  res.status(201).json({
    success: true,
    message: 'Project created successfully'
  });
};

exports.getProjects = async (req, res) => {
  const { tenantId } = req.user;

  const page = parseInt(req.query.page) || 1;
  const limit = parseInt(req.query.limit) || 5;
  const offset = (page - 1) * limit;

  const result = await db.query(
    `
    SELECT id, name, description
    FROM projects
    WHERE tenant_id = $1
    ORDER BY created_at DESC
    LIMIT $2 OFFSET $3
    `,
    [tenantId, limit, offset]
  );

  const count = await db.query(
    'SELECT COUNT(*) FROM projects WHERE tenant_id = $1',
    [tenantId]
  );

  res.json({
    success: true,
    page,
    limit,
    totalRecords: parseInt(count.rows[0].count),
    data: result.rows
  });
};


exports.getProjectById = async (req, res) => {
  const { id } = req.params;
  const { tenantId } = req.user;

  const result = await db.query(
    'SELECT * FROM projects WHERE id = $1 AND tenant_id = $2',
    [id, tenantId]
  );

  if (result.rowCount === 0) {
    return res.status(404).json({
      success: false,
      message: 'Project not found'
    });
  }

  res.json({
    success: true,
    data: result.rows[0]
  });
};

exports.updateProject = async (req, res) => {
  const { id } = req.params;
  const { name, description, status } = req.body;
  const { tenantId } = req.user;

  await db.query(
    `UPDATE projects
     SET name = $1, description = $2, status = $3
     WHERE id = $4 AND tenant_id = $5`,
    [name, description, status, id, tenantId]
  );
  await logAudit({
  userId: req.user.userId,
  tenantId: req.user.tenantId,
  action: 'UPDATE_PROJECT',
  entityType: 'project',
  entityId: req.params.id
});

  res.json({
    success: true,
    message: 'Project updated successfully'
  });
};

exports.deleteProject = async (req, res) => {
  const { id } = req.params;
  const { tenantId } = req.user;

  await db.query(
    'DELETE FROM projects WHERE id = $1 AND tenant_id = $2',
    [id, tenantId]
  );
  await logAudit({
  userId: req.user.userId,
  tenantId: req.user.tenantId,
  action: 'DELETE_PROJECT',
  entityType: 'project',
  entityId: req.params.id
});

  res.json({
    success: true,
    message: 'Project deleted successfully'
  });
};

